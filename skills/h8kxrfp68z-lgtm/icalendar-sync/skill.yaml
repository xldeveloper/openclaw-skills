# =============================================================================
# iCalendar Sync v2.2.30 - OpenClaw Skill Definition
# =============================================================================
#
# CRITICAL: This skill REQUIRES credentials:
#   - ICLOUD_USERNAME (Apple ID email)
#   - ICLOUD_APP_PASSWORD (App-Specific Password from appleid.apple.com)
#
# These are explicitly declared as REQUIRED in ALL metadata files.
#
# NEW in v2.2.30:
#   - ðŸ”§ Fixed metadata structure to match verified working version
#   - ðŸ—‘ï¸ Removed redundant CLAWHUB.yaml causing registry conflicts
#
# From v2.2.16:
#   - ðŸ”§ ClawHub integration fixes
#   - ðŸ“¦ Added _meta.json for proper registry integration
#
# From v2.2.15:
#   - ðŸ§¹ Cleaned up repository: removed old internal files (bugfix notes, release instructions, etc.)
#   - ðŸ›¡ï¸ Added comprehensive security documentation addressing ClawHub concerns
#   - ðŸ“‹ Added authoritative CLAWHUB.yaml with explicit metadata declarations
#   - âœ… Removed redundant metadata files
#
# From v2.2.14:
#   - ðŸ“ Restructured repository: flattened directory structure for ClawHub
#
# From v2.2.13:
#   - ðŸ”„ Version bump to force ClawHub re-indexing (cache issue fix)
#
# From v2.2.12:
#   - ðŸŒ Cyrillic/Unicode calendar names support (Ð›Ð¸Ñ‡Ð½Ñ‹Ð¹, Ð Ð°Ð±Ð¾Ñ‚Ð°, å·¥ä½œ, etc.)
#   - ðŸ”§ Headless configuration: --username and --non-interactive flags
#   - âœ… Fixed RuntimeWarning when using python -m icalendar_sync
#   - ðŸ™ Field-tested fixes from real OpenClaw users (thanks Alfred!)
#
# From v2.2.9:
#   - Added explicit branch: skills to metadata for ClawHub indexing
#   - Multiple metadata formats for maximum compatibility
#
# From v2.2.8:
#   - Simplified CLAWHUB_METADATA.yaml (30 lines vs 160)
#   - Fixed ClawHub security scan "metadata_env_mismatch" issue
#   - Explicitly declared required_env_vars at top level
# =============================================================================


name: icalendar-sync
display_name: "iCalendar Sync"
version: 2.2.30
description: >
  Professional iCloud Calendar integration for OpenClaw.
  Provides bidirectional CalDAV sync with iCloud calendars.
  Core functionality: create, read, update, delete calendar events.

  REQUIRES: ICLOUD_USERNAME and ICLOUD_APP_PASSWORD (see environment section below).

  v2.2.12 adds Cyrillic support, headless config, and critical bug fixes.


author: Black_Temple
license: MIT
repository: https://github.com/h8kxrfp68z-lgtm/iCalendar-Sync
homepage: https://clawhub.ai/skills/icalendar-sync


category: productivity
tags:
  - calendar
  - icloud
  - apple
  - caldav
  - sync
  - productivity
  - scheduling
  - russian
  - cyrillic


runtime:
  type: python
  version: ">=3.9"


dependencies:
  python:
    - caldav>=1.3.0
    - icalendar>=5.0.0
    - pyyaml>=6.0
    - python-dateutil>=2.8.0
    - keyring>=24.0.0
    - python-dotenv>=1.0.0


# =============================================================================
# CREDENTIALS: These are REQUIRED despite any cached metadata saying "none"
# =============================================================================
environment:
  - name: ICLOUD_USERNAME
    description: "Apple ID email address (e.g., name@icloud.com)"
    required: true
    placeholder: "user@icloud.com"
  
  - name: ICLOUD_APP_PASSWORD
    description: "App-Specific Password from appleid.apple.com (stored in system keyring, this is fallback only)"
    required: true
    secure: true
    placeholder: "xxxx-xxxx-xxxx-xxxx"
  
  - name: DEFAULT_CALENDAR
    description: "Default calendar name if not specified"
    required: false
    default: "Personal"
  
  - name: LOG_LEVEL
    description: "Logging level (DEBUG, INFO, WARNING, ERROR)"
    required: false
    default: "INFO"


# =============================================================================
# SECURITY
# =============================================================================
security:
  credential_storage: "System keyring (macOS Keychain, Windows Credential Manager, Linux Secret Service)"
  input_validation: true
  rate_limiting: "10 calls per 60 seconds"
  ssl_verification: true
  sensitive_data_filtering: true


# =============================================================================
# CAPABILITIES
# =============================================================================
capabilities:
  agent_aware: false
  supports_isolation: false


# =============================================================================
# COMMANDS
# =============================================================================  
commands:
  - name: list
    description: List accessible iCloud calendars
    usage: "icalendar-sync list"
    permissions: [read]
  
  - name: get
    description: Sync and retrieve calendar events
    usage: "icalendar-sync get --calendar <name> [--days 7]"
    permissions: [read]
  
  - name: create
    description: Create a new calendar event
    usage: "icalendar-sync create --calendar <name> --json <data>"
    permissions: [create]
  
  - name: delete
    description: Remove event from calendar
    usage: "icalendar-sync delete --calendar <name> --uid <uid>"
    permissions: [delete]
  
  - name: setup
    description: Configure iCloud credentials interactively or via CLI
    usage: "icalendar-sync setup [--username EMAIL] [--password PWD] [--non-interactive]"
    permissions: [admin]
