#!/bin/bash

# AI Persona OS â€” Daily Ops
# Automated daily operations check
# By Jeff J Hunter â€” https://jeffjhunter.com

WORKSPACE="${1:-$HOME/workspace}"
TODAY=$(date +%Y-%m-%d)

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  AI Persona OS â€” Daily Ops"
echo "  $(date)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Step 1: Check if today's log exists
echo "ğŸ“… Checking today's log..."
if [ ! -f "$WORKSPACE/memory/$TODAY.md" ]; then
    echo "   Creating $TODAY.md..."
    cat > "$WORKSPACE/memory/$TODAY.md" << EOF
# $TODAY â€” $(date +%A)

## Heartbeat

**Completed:** $(date +%H:%M)
**Status:** ğŸŸ¢
**Focus:** [Set your focus]

## Session Notes

[What happened today]

## Decisions Made

| Decision | Reasoning | Time |
|----------|-----------|------|

## Action Items

### In Progress
- [ ] 

## Learnings

- 

## Checkpoints

---

*Generated by AI Persona OS daily-ops*
EOF
    echo "   âœ“ Created"
else
    echo "   âœ“ Already exists"
fi

# Step 2: Check for pending items from yesterday
echo ""
echo "ğŸ“‹ Checking yesterday's pending items..."
YESTERDAY=$(date -d "yesterday" +%Y-%m-%d 2>/dev/null || date -v-1d +%Y-%m-%d 2>/dev/null)
if [ -f "$WORKSPACE/memory/$YESTERDAY.md" ]; then
    pending=$(grep -c "^\- \[ \]" "$WORKSPACE/memory/$YESTERDAY.md" 2>/dev/null || echo "0")
    if [ "$pending" -gt 0 ]; then
        echo "   âš ï¸  $pending uncompleted items from yesterday"
    else
        echo "   âœ“ No pending items"
    fi
else
    echo "   â—‹ No log from yesterday"
fi

# Step 3: Check MEMORY.md size
echo ""
echo "ğŸ’¾ Checking MEMORY.md size..."
if [ -f "$WORKSPACE/MEMORY.md" ]; then
    size=$(wc -c < "$WORKSPACE/MEMORY.md")
    if [ "$size" -gt 4096 ]; then
        echo "   âš ï¸  $size bytes (should be < 4096)"
    else
        echo "   âœ“ $size bytes (OK)"
    fi
fi

# Step 4: Check .learnings for items to review
echo ""
echo "ğŸ“ˆ Checking learning system..."
if [ -d "$WORKSPACE/.learnings" ]; then
    pending=$(grep -c "pending" "$WORKSPACE/.learnings/LEARNINGS.md" 2>/dev/null || echo "0")
    if [ "$pending" -gt 5 ]; then
        echo "   âš ï¸  $pending pending learnings (review needed)"
    else
        echo "   âœ“ $pending pending learnings"
    fi
fi

# Step 5: Check for stale logs
echo ""
echo "ğŸ—„ï¸  Checking for stale logs..."
stale=$(find "$WORKSPACE/memory" -maxdepth 1 -name "*.md" -type f -mtime +90 2>/dev/null | wc -l | tr -d ' ')
if [ "$stale" -gt 0 ]; then
    echo "   âš ï¸  $stale logs need archiving (> 90 days old)"
else
    echo "   âœ“ No stale logs"
fi

# Summary
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "  Daily ops complete"
echo "  Today's log: memory/$TODAY.md"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
